<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Карта сбора байков - 07.11.2025</title>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=442d74dc-b3ec-4802-a10a-76b4563ba79a"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* Основные стили карты */
body { 
    margin: 0; 
    padding: 0; 
    font-family: Arial, sans-serif;
}
#container {
    display: flex;
    height: 100vh;
}
#sidebar {
    width: 300px;
    background: #f5f5f5;
    border-right: 1px solid #ddd;
    overflow-y: auto;
    padding: 10px;
    box-sizing: border-box;
}
#map { 
    flex: 1; 
    height: 100vh; 
}

/* Баллуны */
.balloon-content {
    font-family: Arial, sans-serif;
    max-width: 250px;
}
.balloon-title {
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 14px;
}
.balloon-status {
    color: #666;
    margin-bottom: 3px;
}
.balloon-days {
    color: #cc0000;
    font-weight: bold;
}
.balloon-actions { 
    margin-top: 8px; 
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* Кнопки */
.route-link, .edit-link, .delete-link {
    display: inline-flex; 
    align-items: center; 
    justify-content: center;
    gap: 6px;
    padding: 8px 12px; 
    border-radius: 8px;
    color: #fff; 
    text-decoration: none;
    font-weight: 600; 
    font-size: 12px;
    box-shadow: 0 1px 2px rgba(0,0,0,.08);
    transition: background .15s ease, transform .05s ease;
    border: none;
    cursor: pointer;
}
.route-link { background: #1E98FF; }
.route-link:hover { background: #157fd6; }
.edit-link { background: #FFA500; }
.edit-link:hover { background: #e59400; }
.delete-link { background: #FF4444; }
.delete-link:hover { background: #cc3333; }
.route-link:active, .edit-link:active, .delete-link:active { 
    transform: translateY(1px); 
}

/* Общие кнопки */
.btn {
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    margin-right: 5px;
}
.btn-primary {
    background: #1E98FF;
    color: white;
}
.btn-success {
    background: #28a745;
    color: white;
}
.btn-danger {
    background: #dc3545;
    color: white;
}

/* Списки */
.object-list {
    list-style: none;
    padding: 0;
    margin: 0;
}
.object-item {
    padding: 8px 10px;
    margin-bottom: 5px;
    background: white;
    border-radius: 4px;
    cursor: pointer;
    border-left: 4px solid #1E98FF;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.object-item:hover {
    background: #e9f7fe;
}
.object-item.bike {
    border-left-color: #1E98FF;
}
.object-item.warehouse {
    border-left-color: #FFD700;
}
.object-item.parking {
    border-left-color: #FF6B00;
}
.object-title {
    font-weight: bold;
    font-size: 13px;
}
.object-subtitle {
    font-size: 11px;
    color: #666;
    margin-top: 2px;
}

/* Поиск и фильтры */
.search-box {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}
.section-title {
    font-weight: bold;
    margin: 15px 0 8px 0;
    font-size: 14px;
    color: #333;
}
.filter-section {
    margin-bottom: 15px;
    padding: 10px;
    background: #fff;
    border-radius: 5px;
    box-shadow: 0 0 6px rgba(0,0,0,0.08);
    font-size: 13px;
    overflow: hidden;
}

/* Чипсы фильтров */
.filter-chips {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 8px;
    margin-top: 8px;
}
.chip {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    border: 1px solid #E6E6E6;
    border-radius: 10px;
    padding: 8px 10px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 1px 2px rgba(0,0,0,.04);
    transition: background .2s, border-color .2s, box-shadow .2s;
    font-size: 12px;
    min-height: 36px;
    box-sizing: border-box;
}
.chip:hover { 
    border-color: #D6D6D6; 
    box-shadow: 0 2px 6px rgba(0,0,0,.06); 
}
.chip.active { 
    background: #F2F6FF; 
    border-color: #1E98FF; 
    box-shadow: 0 2px 8px rgba(30,152,255,.15); 
}
.chip .pin-img { 
    height: 20px; 
    width: auto; 
    max-width: 24px; 
    flex: 0 0 auto; 
    display: block; 
    object-fit: contain; 
}
.chip-label { 
    line-height: 1; 
    color: #222; 
}
.chip-count { 
    margin-left: auto; 
    font-size: 11px; 
    padding: 2px 6px; 
    border-radius: 999px; 
    background: #F0F0F0; 
    color: #555; 
}
.chip.active .chip-count { 
    background: #E4F1FF; 
    color: #1E98FF; 
}

/* Управление боковой панелью */
.sidebar-toggle {
    position: sticky; 
    top: 0; 
    right: 0; 
    width: 28px; 
    height: 28px;
    margin-left: auto; 
    border: 0; 
    border-radius: 6px; 
    cursor: pointer;
    background: #e9f2ff; 
    color: #1E98FF; 
    display: inline-flex; 
    align-items: center; 
    justify-content: center;
}
.sidebar-toggle:hover { 
    background:#dcebff; 
}
.sidebar-fab {
    position: absolute; 
    top: 44px; 
    left: 8px; 
    z-index: 1100;
    width: 36px; 
    height: 36px; 
    border: 0; 
    border-radius: 10px;
    background: #fff; 
    color: #666; 
    cursor: pointer; 
    display: none;
    box-shadow: 0 2px 8px rgba(0,0,0,.2);
}
#sidebar.collapsed ~ #map + .sidebar-fab, 
#sidebar.collapsed ~ .sidebar-fab { 
    display: block; 
}

/* Защита редактирования */
.edit-protection {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 5px;
    padding: 10px;
    margin: 10px 0;
    text-align: center;
}
.login-form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin: 20px 0;
}
.login-input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
}
.login-btn {
    background: #1E98FF;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    width: 100%;
}
.login-btn:hover {
    background: #157fd6;
}

/* Управление данными */
.data-management {
    background: #fff;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.data-management h4 {
    margin: 0 0 10px 0;
    color: #333;
}
.form-group {
    margin-bottom: 10px;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 12px;
    color: #666;
}
.form-group input, .form-group select {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}

/* Время обновления */
.last-update {
    font-size: 12px;
    color: #666;
    margin-top: 10px;
    text-align: center;
}

/* Утилиты */
.hidden { 
    display: none !important; 
}

/* Адаптивность */
@media (max-width: 768px){
    #sidebar { 
        position: relative; 
        z-index: 1000; 
    }
    #sidebar.collapsed { 
        width: 0; 
        padding: 0; 
        border-right: 0; 
        overflow: hidden; 
    }
    #sidebar.collapsed .sidebar-inner { 
        opacity: 0; 
    }
}
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <div class="sidebar-inner">
                <div style="display:flex; align-items:center; gap:8px;">
                    <h3 style="margin: 0 0 12px 0;">Карта сбора байков</h3>
                    <button id="sidebarToggle" class="sidebar-toggle" title="Свернуть/развернуть">⟨</button>
                </div>
                
                <!-- Защита редактирования -->
                <div id="editProtection" class="edit-protection">
                    <div id="loginSection">
                        <h4>Доступ к редактированию</h4>
                        <div class="login-form">
                            <input type="password" id="passwordInput" class="login-input" placeholder="Введите пароль">
                            <button onclick="checkEditPassword()" class="login-btn">Разблокировать редактирование</button>
                        </div>
                    </div>
                    <div id="editSection" class="hidden">
                        <h4>✏️ Режим редактирования</h4>
                        
                        <!-- Форма управления данными -->
                        <div class="data-management">
                            <h4>Управление данными</h4>
                            <div class="form-group">
                                <label for="bikeNumber">Номер байка:</label>
                                <input type="text" id="bikeNumber" placeholder="A1234">
                            </div>
                            <div class="form-group">
                                <label for="bikeLat">Широта:</label>
                                <input type="number" id="bikeLat" step="any" placeholder="55.751244">
                            </div>
                            <div class="form-group">
                                <label for="bikeLon">Долгота:</label>
                                <input type="number" id="bikeLon" step="any" placeholder="37.618423">
                            </div>
                            <div class="form-group">
                                <label for="bikeStatus">Статус:</label>
                                <select id="bikeStatus">
                                    <option value="Онлайн">Онлайн</option>
                                    <option value="Парт-тайм">Парт-тайм</option>
                                    <option value="Оффлайн <2 дней">Оффлайн <2 дней</option>
                                    <option value="Оффлайн >2 дней">Оффлайн >2 дней</option>
                                    <option value="Утерян">Утерян</option>
                                    <option value="Утерян (парт-тайм)">Утерян (парт-тайм)</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-primary" onclick="addBike()">Добавить байк</button>
                                <button class="btn btn-success" onclick="refreshData()">Обновить данные</button>
                                <button class="btn btn-danger" onclick="lockEditing()">Заблокировать</button>
                            </div>
                            <div class="last-update" id="lastUpdate">
                                Последнее обновление: 07.11.2025 15:40
                            </div>
                        </div>
                    </div>
                </div>

                <input type="text" class="search-box" placeholder="Поиск байков..." id="searchInput">
                
                <div class="filter-section">
                    <div class="section-title" style="margin-top:0">Фильтр по статусу</div>
                    <div id="statusChips" class="filter-chips"></div>
                </div>
                
                <div class="section-title">Байки (<span id="bikeCount">0</span>):</div>
                <ul class="object-list" id="bikeList"></ul>

                <div class="section-title">Склады (11):</div>
                <ul class="object-list" id="warehouseList"></ul>
            </div>
        </div>
        
        <button id="sidebarShow" class="sidebar-fab" title="Показать фильтры">☰</button>
        <div id="map"></div>
    </div>

    <script>
        // Конфигурация
        window.CONFIG = {"sheetId": "1SB18QuCrFGJmGtmc0T7oE0Gx_mgsxzBOi83nCArlaO8", "passwordHash": "20d1bb87bf2f69fd3c54e2b918803260a498a3e967671c7434d4f729e1fb4e08", "mapCenter": [55.75, 37.62], "mapZoom": 10};
        
        // Данные для карты
        window.BIKES_DATA = [{"lat": 59.85673904418945, "lon": 30.37275505065918, "label": "YA087E", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA087E"}, {"lat": 59.92033767700195, "lon": 30.31812858581543, "label": "YA558C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA558C"}, {"lat": 59.909324645996094, "lon": 30.291494369506836, "label": "YX681C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX681C"}, {"lat": 59.989627838134766, "lon": 30.302284240722656, "label": "YA041C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA041C"}, {"lat": 59.82929611206055, "lon": 30.537879943847656, "label": "YX228C", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 3, "plate": "YX228C"}, {"lat": 59.96331024169922, "lon": 30.29799461364746, "label": "YX631B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX631B"}, {"lat": 59.9735221862793, "lon": 30.407907485961914, "label": "YA803M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA803M"}, {"lat": 60.01263427734375, "lon": 30.39679527282715, "label": "YA719M", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 3, "plate": "YA719M"}, {"lat": 59.93539047241211, "lon": 30.274730682373047, "label": "YA303T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA303T"}, {"lat": 59.85417175292969, "lon": 30.347061157226562, "label": "YA319M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA319M"}, {"lat": 59.93245315551758, "lon": 30.299787521362305, "label": "YX868C", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 7, "plate": "YX868C"}, {"lat": 59.93027114868164, "lon": 30.38459014892578, "label": "YX020H", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX020H"}, {"lat": 60.05781555175781, "lon": 30.349117279052734, "label": "YA066T", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 8, "plate": "YA066T"}, {"lat": 59.979793548583984, "lon": 30.348827362060547, "label": "YX714A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 7, "plate": "YX714A"}, {"lat": 59.84790802001953, "lon": 30.311981201171875, "label": "YA744T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA744T"}, {"lat": 59.83763885498047, "lon": 30.1125545501709, "label": "YA103E", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 9, "plate": "YA103E"}, {"lat": 59.8387451171875, "lon": 30.113296508789062, "label": "YA029M", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YA029M"}, {"lat": 59.99412536621094, "lon": 30.316871643066406, "label": "YA878M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA878M"}, {"lat": 59.83153533935547, "lon": 30.327661514282227, "label": "YX628C", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YX628C"}, {"lat": 59.90412521362305, "lon": 30.306476593017578, "label": "YA623M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA623M"}, {"lat": 59.90230178833008, "lon": 30.511293411254883, "label": "YA444C", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 12, "plate": "YA444C"}, {"lat": 59.92278289794922, "lon": 30.518688201904297, "label": "YA349C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA349C"}, {"lat": 59.87343215942383, "lon": 30.368873596191406, "label": "YA074M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA074M"}, {"lat": 59.85310363769531, "lon": 30.270143508911133, "label": "YA958X", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA958X"}, {"lat": 59.94140625, "lon": 30.35883331298828, "label": "YA603T", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 10, "plate": "YA603T"}, {"lat": 59.82632827758789, "lon": 30.334211349487305, "label": "YX576C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX576C"}, {"lat": 59.92876052856445, "lon": 30.43022346496582, "label": "YA531C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA531C"}, {"lat": 60.03651809692383, "lon": 30.244394302368164, "label": "YA968C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA968C"}, {"lat": 59.906700134277344, "lon": 30.44805908203125, "label": "YA239M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA239M"}, {"lat": 59.84134292602539, "lon": 30.22551727294922, "label": "YX496A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX496A"}, {"lat": 59.96588134765625, "lon": 30.31089973449707, "label": "YA487C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA487C"}, {"lat": 59.95578384399414, "lon": 30.479740142822266, "label": "YA225M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA225M"}, {"lat": 59.8436393737793, "lon": 30.315574645996094, "label": "YA028M", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 7, "plate": "YA028M"}, {"lat": 59.86534118652344, "lon": 30.26943016052246, "label": "YA440O", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA440O"}, {"lat": 60.05379104614258, "lon": 30.32199478149414, "label": "YA163C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA163C"}, {"lat": 59.95812225341797, "lon": 30.333688735961914, "label": "YX467B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX467B"}, {"lat": 60.03487014770508, "lon": 30.250303268432617, "label": "YX963C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YX963C"}, {"lat": 59.985897064208984, "lon": 30.348012924194336, "label": "YA024E", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA024E"}, {"lat": 59.92877197265625, "lon": 30.47506332397461, "label": "YA253M", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 5, "plate": "YA253M"}, {"lat": 59.910797119140625, "lon": 30.460315704345703, "label": "YA030E", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA030E"}, {"lat": 59.928714752197266, "lon": 30.475107192993164, "label": "YA609T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA609T"}, {"lat": 59.9042854309082, "lon": 30.305126190185547, "label": "YA110P", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA110P"}, {"lat": 59.93427276611328, "lon": 30.432830810546875, "label": "YA531T", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 30, "plate": "YA531T"}, {"lat": 59.847293853759766, "lon": 30.27650260925293, "label": "YA007E", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA007E"}, {"lat": 59.977294921875, "lon": 30.332794189453125, "label": "YA909M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA909M"}, {"lat": 59.85442352294922, "lon": 30.32657241821289, "label": "YA731P", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA731P"}, {"lat": 59.89640426635742, "lon": 30.263471603393555, "label": "YA693P", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 27, "plate": "YA693P"}, {"lat": 59.95783233642578, "lon": 30.220630645751953, "label": "YA211M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA211M"}, {"lat": 59.82930374145508, "lon": 30.330806732177734, "label": "YA360M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA360M"}, {"lat": 60.02180480957031, "lon": 30.241422653198242, "label": "YA475M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA475M"}, {"lat": 59.98902130126953, "lon": 30.3791446685791, "label": "YA973M", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 0, "plate": "YA973M"}, {"lat": 59.899227142333984, "lon": 30.2724552154541, "label": "YA461M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA461M"}, {"lat": 59.93255615234375, "lon": 30.432710647583008, "label": "YA424M", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 1, "plate": "YA424M"}, {"lat": 59.89801788330078, "lon": 30.5116024017334, "label": "YA854M", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA854M"}, {"lat": 60.03550720214844, "lon": 30.228208541870117, "label": "YX654B", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YX654B"}, {"lat": 59.94622039794922, "lon": 30.386402130126953, "label": "YX243C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YX243C"}, {"lat": 59.90131378173828, "lon": 30.28069496154785, "label": "YA486C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA486C"}, {"lat": 59.93766403198242, "lon": 30.282955169677734, "label": "YX552B", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YX552B"}, {"lat": 59.931312561035156, "lon": 30.470869064331055, "label": "YA632T", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA632T"}, {"lat": 59.93783950805664, "lon": 30.435155868530273, "label": "YX511B", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YX511B"}, {"lat": 59.85708236694336, "lon": 30.473346710205078, "label": "YX630B", "preset": "islands#darkOrangeCircleIcon", "status": "Утерян (парт-тайм)", "heartbeat_days": 31, "plate": "YX630B"}, {"lat": 55.805763244628906, "lon": 37.72135925292969, "label": "YA748B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA748B"}, {"lat": 55.41852569580078, "lon": 37.54085922241211, "label": "YA258A", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 0, "plate": "YA258A"}, {"lat": 55.764984130859375, "lon": 37.60442352294922, "label": "YA997T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA997T"}, {"lat": 55.7541618347168, "lon": 37.79881286621094, "label": "YA966T", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YA966T"}, {"lat": 55.843284606933594, "lon": 37.49281692504883, "label": "YA568A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA568A"}, {"lat": 55.864601135253906, "lon": 37.617042541503906, "label": "YA275B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA275B"}, {"lat": 55.69340896606445, "lon": 37.93962860107422, "label": "YA805O", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA805O"}, {"lat": 55.790340423583984, "lon": 37.67064666748047, "label": "YA729O", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 7, "plate": "YA729O"}, {"lat": 55.70631408691406, "lon": 37.692115783691406, "label": "YA201A", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 0, "plate": "YA201A"}, {"lat": 56.00276184082031, "lon": 37.203575134277344, "label": "YA476A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YA476A"}, {"lat": 55.804718017578125, "lon": 37.77230453491211, "label": "YA791B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA791B"}, {"lat": 55.69313049316406, "lon": 37.94138717651367, "label": "YA215B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA215B"}, {"lat": 55.81407165527344, "lon": 37.656986236572266, "label": "YA379B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA379B"}, {"lat": 55.98112106323242, "lon": 37.144989013671875, "label": "YA339A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YA339A"}, {"lat": 55.69380187988281, "lon": 37.9389762878418, "label": "YA062T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA062T"}, {"lat": 55.5621337890625, "lon": 37.703792572021484, "label": "YA970B", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 4, "plate": "YA970B"}, {"lat": 55.8702278137207, "lon": 37.47759246826172, "label": "YA104C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA104C"}, {"lat": 55.78388214111328, "lon": 37.4639778137207, "label": "YA578O", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA578O"}, {"lat": 55.70000457763672, "lon": 37.9642333984375, "label": "YA916B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA916B"}, {"lat": 55.83942794799805, "lon": 37.44232940673828, "label": "YA437O", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA437O"}, {"lat": 55.78986358642578, "lon": 37.622867584228516, "label": "YA640C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA640C"}, {"lat": 55.841487884521484, "lon": 37.664512634277344, "label": "YA322A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 4, "plate": "YA322A"}, {"lat": 55.78326416015625, "lon": 37.47032165527344, "label": "YA746C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA746C"}, {"lat": 55.817867279052734, "lon": 37.79539108276367, "label": "YA652C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA652C"}, {"lat": 55.91051483154297, "lon": 37.748748779296875, "label": "YA222A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA222A"}, {"lat": 55.70768356323242, "lon": 37.79229736328125, "label": "YA062O", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 8, "plate": "YA062O"}, {"lat": 55.77088928222656, "lon": 37.516971588134766, "label": "YA722C", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA722C"}, {"lat": 55.751399993896484, "lon": 37.712432861328125, "label": "YA600P", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 3, "plate": "YA600P"}, {"lat": 55.66447067260742, "lon": 37.428802490234375, "label": "YA715B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA715B"}, {"lat": 48.800167083740234, "lon": 44.58740997314453, "label": "YA189A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 54, "plate": "YA189A"}, {"lat": 55.72900852, "lon": 37.63720719, "label": "YA408A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 3, "plate": "YA408A"}, {"lat": 55.57441329956055, "lon": 36.6950798034668, "label": "YA794B", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 29, "plate": "YA794B"}, {"lat": 55.687496185302734, "lon": 37.46161651611328, "label": "YA742T", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 3, "plate": "YA742T"}, {"lat": 55.75181198120117, "lon": 37.8596076965332, "label": "YA115B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA115B"}, {"lat": 55.596961975097656, "lon": 37.344024658203125, "label": "YA574A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA574A"}, {"lat": 55.771610260009766, "lon": 37.620723724365234, "label": "YA955T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA955T"}, {"lat": 55.77860641479492, "lon": 37.69145965576172, "label": "YA621A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA621A"}, {"lat": 55.79481506347656, "lon": 37.577911376953125, "label": "YA599A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA599A"}, {"lat": 55.827823638916016, "lon": 37.42698669433594, "label": "YA763T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA763T"}, {"lat": 56.003944396972656, "lon": 37.48344802856445, "label": "YA570C", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 1, "plate": "YA570C"}, {"lat": 55.65422821044922, "lon": 37.702178955078125, "label": "YA045B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA045B"}, {"lat": 55.609981536865234, "lon": 37.76142501831055, "label": "YA362T", "preset": "islands#blackAttentionCircleIcon", "status": "Утерян", "heartbeat_days": 47, "plate": "YA362T"}, {"lat": 55.8503303527832, "lon": 37.67033386230469, "label": "YA699T", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA699T"}, {"lat": 55.934024810791016, "lon": 37.853328704833984, "label": "YA655A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA655A"}, {"lat": 55.59696578979492, "lon": 37.3416633605957, "label": "YA441B", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA441B"}, {"lat": 55.73996353149414, "lon": 37.40501022338867, "label": "YA798A", "preset": "islands#blueBicycleCircleIcon", "status": "Онлайн", "heartbeat_days": 0, "plate": "YA798A"}, {"lat": 53.94873809814453, "lon": 27.698694229125977, "label": "YA924C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA924C"}, {"lat": 55.77704177, "lon": 37.58303698, "label": "YA134C", "preset": "islands#redBicycleCircleIcon", "status": "Оффлайн <2 дней", "heartbeat_days": 0, "plate": "YA134C"}, {"lat": 55.752967834472656, "lon": 37.53679275512695, "label": "YA569C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA569C"}, {"lat": 55.65544891357422, "lon": 37.846405029296875, "label": "YA213C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA213C"}, {"lat": 55.65679931640625, "lon": 37.503318786621094, "label": "YX671A", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YX671A"}, {"lat": 55.76629638671875, "lon": 37.48660659790039, "label": "YA521T", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA521T"}, {"lat": 55.54026794433594, "lon": 37.52098083496094, "label": "YX067A", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 2, "plate": "YX067A"}, {"lat": 55.54827880859375, "lon": 37.68508529663086, "label": "YA096O", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA096O"}, {"lat": 55.63956832885742, "lon": 37.34492111206055, "label": "YA055C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA055C"}, {"lat": 55.639469146728516, "lon": 37.344974517822266, "label": "YA736T", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA736T"}, {"lat": 55.50162124633789, "lon": 37.56427001953125, "label": "YA433C", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA433C"}, {"lat": 45.03481674194336, "lon": 39.05232238769531, "label": "YA300C", "preset": "islands#redCircleIcon", "status": "Оффлайн >2 дней", "heartbeat_days": 7, "plate": "YA300C"}, {"lat": 55.846435546875, "lon": 37.3640251159668, "label": "YA101P", "preset": "islands#darkorangeBicycle2CircleIcon", "status": "Парт-тайм", "heartbeat_days": 0, "plate": "YA101P"}, {"lat": 55.88302230834961, "lon": 37.45515823364258, "label": "YA153T", "preset": "islands#darkOrangeCircleIcon", "status": "Утерян (парт-тайм)", "heartbeat_days": 35, "plate": "YA153T"}];
        window.POLYGONS_DATA = [{"id": "polygon-279259", "revision": 2, "name": " Парковка Яндекс №84", "geometry": {"type": "Polygon", "coordinates": [[[37.43987133056096, 55.85129169584939], [37.44033332706156, 55.85129169584939], [37.44033332706156, 55.8514858524425], [37.43987133056096, 55.8514858524425], [37.43987133056096, 55.85129169584939]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263717", "revision": 3, "name": "__Парковочная зона _№7", "geometry": {"type": "Polygon", "coordinates": [[[37.5863659436244, 55.89896157339022], [37.5872731631415, 55.89895500483663], [37.58728750275276, 55.8995304734501], [37.58638028323546, 55.899538649348266], [37.5863659436244, 55.89896157339022]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263562", "revision": 1, "name": "__Парковочная зона_№26", "geometry": {"type": "Polygon", "coordinates": [[[37.524963326481455, 55.64175011488125], [37.52681941511968, 55.641367830035335], [37.52766162875044, 55.64257231801065], [37.52591819289082, 55.6428575061891], [37.524963326481455, 55.64175011488125]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263563", "revision": 1, "name": "__Парковочная зона_№40", "geometry": {"type": "Polygon", "coordinates": [[[37.568567327883294, 55.6567514561617], [37.57094912948872, 55.656047834457], [37.57226877632402, 55.65725490182791], [37.56986551704675, 55.658019156315575], [37.568567327883294, 55.6567514561617]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263564", "revision": 1, "name": "__Парковочная зона_№46", "geometry": {"type": "Polygon", "coordinates": [[[37.60316514196561, 55.610319334894754], [37.607542507077895, 55.609675605079204], [37.608497373487204, 55.61178894243418], [37.604173652555204, 55.612262605812944], [37.60316514196561, 55.610319334894754]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263565", "revision": 1, "name": "__Парковочная зона_№19", "geometry": {"type": "Polygon", "coordinates": [[[37.715996873118534, 55.61027961079128], [37.71813727591234, 55.610516452350744], [37.71760619852747, 55.611609548624], [37.715562355258164, 55.611324131993385], [37.715996873118534, 55.61027961079128]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263566", "revision": 1, "name": "__Парковочная зона_№57", "geometry": {"type": "Polygon", "coordinates": [[[37.74293832156841, 55.649152480856955], [37.74333528850259, 55.64818784263791], [37.745647352673444, 55.64841535380842], [37.744987529255795, 55.6493981867847], [37.74293832156841, 55.649152480856955]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263567", "revision": 1, "name": "__Парковочная зона_№58", "geometry": {"type": "Polygon", "coordinates": [[[37.7304700729607, 55.73043861262757], [37.73234225485308, 55.73053245228294], [37.73206330511553, 55.73108035026438], [37.730250131821464, 55.731001647161904], [37.7304700729607, 55.73043861262757]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263568", "revision": 1, "name": "__Парковочная зона_№59", "geometry": {"type": "Polygon", "coordinates": [[[37.67591125938824, 55.71782117052036], [37.67628945085933, 55.71730639491692], [37.677450847362834, 55.71754107288152], [37.67708606693681, 55.71802859288801], [37.67591125938824, 55.71782117052036]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263570", "revision": 1, "name": "__Парковочная зона_№62", "geometry": {"type": "Polygon", "coordinates": [[[37.496087850252756, 55.82025329015414], [37.496849597612986, 55.81932913100864], [37.499156297365786, 55.819800273719544], [37.49844819418587, 55.82083918355422], [37.496087850252756, 55.82025329015414]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263571", "revision": 1, "name": "__Парковочная зона_№63", "geometry": {"type": "Polygon", "coordinates": [[[37.48099800927861, 55.876803447413565], [37.48253223283512, 55.876845666944156], [37.482376664712255, 55.87764481364889], [37.48084244115574, 55.877617673088395], [37.48099800927861, 55.876803447413565]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263572", "revision": 1, "name": "__Парковочная зона_№64", "geometry": {"type": "Polygon", "coordinates": [[[37.663451972941935, 55.8699263851014], [37.664267364482455, 55.86979819559011], [37.66451680992084, 55.870418025646366], [37.66376310918765, 55.8705009705198], [37.663451972941935, 55.8699263851014]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263573", "revision": 1, "name": "__Парковочная зона_№65", "geometry": {"type": "Polygon", "coordinates": [[[37.67820035923984, 55.78875267812894], [37.67866169919064, 55.78789728792405], [37.68042659272232, 55.7882599998578], [37.679884786501475, 55.78903981903035], [37.67820035923984, 55.78875267812894]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263574", "revision": 1, "name": "__Парковочная зона_№60", "geometry": {"type": "Polygon", "coordinates": [[[37.46913462565609, 55.730293020323515], [37.47086196826169, 55.730468591764605], [37.47059374736019, 55.73115270740146], [37.46885567591854, 55.73095897676164], [37.46913462565609, 55.730293020323515]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263575", "revision": 1, "name": "__Парковочная зона_№6", "geometry": {"type": "Polygon", "coordinates": [[[37.62069504177267, 55.76703138308006], [37.62229893282552, 55.76669822959768], [37.62274763806896, 55.76751545218964], [37.621177524665114, 55.76773320474903], [37.62069504177267, 55.76703138308006]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263576", "revision": 1, "name": "__Парковочная зона_№3", "geometry": {"type": "Polygon", "coordinates": [[[37.61560135329877, 55.794484430398825], [37.61720848423732, 55.79450849694987], [37.6170817306594, 55.795781454173046], [37.615530061228334, 55.795719490153004], [37.61560135329877, 55.794484430398825]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263577", "revision": 1, "name": "__Парковочная зона_№38", "geometry": {"type": "Polygon", "coordinates": [[[37.61629269202376, 55.79316307052843], [37.61770623694391, 55.793113957964295], [37.61783153868116, 55.79372708035663], [37.616398616980085, 55.793758109619496], [37.61629269202376, 55.79316307052843]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263578", "revision": 1, "name": "__Парковочная зона_№50", "geometry": {"type": "Polygon", "coordinates": [[[37.49958851932029, 55.697178794397146], [37.501374036810766, 55.69810157333121], [37.49999170068919, 55.6987090189301], [37.498346062448825, 55.69784189905011], [37.49958851932029, 55.697178794397146]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263579", "revision": 1, "name": "__Парковочная зона_№25", "geometry": {"type": "Polygon", "coordinates": [[[37.6322323741746, 55.77978308043452], [37.634642702026234, 55.77952187332928], [37.635186984580976, 55.78099899703614], [37.63287693017169, 55.78118884794567], [37.6322323741746, 55.77978308043452]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263580", "revision": 1, "name": "__Парковочная зона_№22", "geometry": {"type": "Polygon", "coordinates": [[[37.58617871240173, 55.777535413717125], [37.58685401053431, 55.77711173975126], [37.587756898430094, 55.777634721441274], [37.586970715551736, 55.778014142454325], [37.58617871240173, 55.777535413717125]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263581", "revision": 1, "name": "__Парковочная зона_№31", "geometry": {"type": "Polygon", "coordinates": [[[37.579455996831875, 55.7264966593993], [37.58096791290521, 55.725821057994466], [37.58232273603213, 55.72703938046758], [37.58080851580253, 55.72750527006371], [37.579455996831875, 55.7264966593993]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263582", "revision": 1, "name": "__Парковочная зона_№48", "geometry": {"type": "Polygon", "coordinates": [[[37.60410784135476, 55.64031421388301], [37.60562303433961, 55.64025463342515], [37.60558033305174, 55.64120471112413], [37.604209802757886, 55.64120471112413], [37.60410784135476, 55.64031421388301]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263583", "revision": 1, "name": "__Парковочная зона_№30", "geometry": {"type": "Polygon", "coordinates": [[[37.620329684447206, 55.70876162025435], [37.62187688098837, 55.708689890158794], [37.6221871961104, 55.710183790082326], [37.62065202845373, 55.710312708691546], [37.620329684447206, 55.70876162025435]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263584", "revision": 1, "name": "__Парковочная зона_№14", "geometry": {"type": "Polygon", "coordinates": [[[37.62705815704645, 55.73104289517128], [37.629719919315804, 55.73096099449523], [37.62983340009653, 55.732144999160134], [37.62738254248803, 55.73219911758078], [37.62705815704645, 55.73104289517128]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263585", "revision": 1, "name": "__Парковочная зона_№13", "geometry": {"type": "Polygon", "coordinates": [[[37.63652730096813, 55.72851146295352], [37.63794220629755, 55.72853737365278], [37.637804166752964, 55.729696859830035], [37.63633174494699, 55.72966771115827], [37.63652730096813, 55.72851146295352]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263586", "revision": 1, "name": "__Парковочная зона_№20", "geometry": {"type": "Polygon", "coordinates": [[[37.592848782172226, 55.771347069498695], [37.594437639914815, 55.77034878559884], [37.596213528335056, 55.77111830712424], [37.59468898535425, 55.772183037410684], [37.592848782172226, 55.771347069498695]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263587", "revision": 1, "name": "__Парковочная зона_№24", "geometry": {"type": "Polygon", "coordinates": [[[37.59610195270002, 55.7833843048178], [37.59749316754339, 55.78383375634144], [37.59676118822087, 55.78464286318528], [37.595472771182365, 55.784163862567034], [37.59610195270002, 55.7833843048178]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263588", "revision": 1, "name": "__Парковочная зона_№1", "geometry": {"type": "Polygon", "coordinates": [[[37.63432126802309, 55.753446567803145], [37.635901058400634, 55.75363582219019], [37.635370277861334, 55.75460176874209], [37.633826579144035, 55.75429950104106], [37.63432126802309, 55.753446567803145]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263589", "revision": 1, "name": "__Парковочная зона_№11", "geometry": {"type": "Polygon", "coordinates": [[[37.65297130603861, 55.73868794689265], [37.654450190504754, 55.73912956571716], [37.65355428658185, 55.74020101357042], [37.651809631574196, 55.739848693873626], [37.65297130603861, 55.73868794689265]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263590", "revision": 1, "name": "__Парковочная зона_№10", "geometry": {"type": "Polygon", "coordinates": [[[37.65652623638315, 55.74025743132698], [37.65742293270334, 55.740896074402], [37.65585993899102, 55.7415470499143], [37.65504076836901, 55.74103702968888], [37.65652623638315, 55.74025743132698]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263592", "revision": 1, "name": "__Парковочная зона_№42", "geometry": {"type": "Polygon", "coordinates": [[[37.63623886786382, 55.80637355064677], [37.638456459304614, 55.80623126002871], [37.63892843785242, 55.80792085926595], [37.63656116480651, 55.80802048567278], [37.63623886786382, 55.80637355064677]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263593", "revision": 1, "name": "__Парковочная зона_№44", "geometry": {"type": "Polygon", "coordinates": [[[37.79955525304939, 55.79353986150174], [37.80054128550274, 55.79351607993107], [37.80049578587867, 55.79405782367418], [37.79956676921555, 55.79403744166871], [37.79955525304939, 55.79353986150174]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263594", "revision": 1, "name": "__Парковочная зона_№52", "geometry": {"type": "Polygon", "coordinates": [[[37.48603754933445, 55.84019754294391], [37.48763008585215, 55.840489014878415], [37.486466630149486, 55.841934208987], [37.48493802974599, 55.84153769380548], [37.48603754933445, 55.84019754294391]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263595", "revision": 1, "name": "__Парковочная зона_№53", "geometry": {"type": "Polygon", "coordinates": [[[37.54556304431817, 55.86759743050877], [37.547031597305875, 55.86749309107791], [37.547078324027204, 55.86861325685519], [37.545671300539965, 55.86865397718954], [37.54556304431817, 55.86759743050877]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263596", "revision": 1, "name": "__Парковочная зона_№55", "geometry": {"type": "Polygon", "coordinates": [[[37.60441919163048, 55.8641920257902], [37.605908714721174, 55.8636911021156], [37.60687012738591, 55.86473406549523], [37.60558287934603, 55.86510355034612], [37.60441919163048, 55.8641920257902]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263597", "revision": 1, "name": "__Парковочная зона_№49", "geometry": {"type": "Polygon", "coordinates": [[[37.48038334417685, 55.660254279667704], [37.48238432663579, 55.65997010677681], [37.48292405680455, 55.66158353604747], [37.48091709851266, 55.66180694011099], [37.48038334417685, 55.660254279667704]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263598", "revision": 1, "name": "__Парковочная зона_№41", "geometry": {"type": "Polygon", "coordinates": [[[37.60366580662049, 55.81206462276091], [37.604730405016745, 55.81252250739327], [37.603216795317564, 55.813399980146066], [37.60227531434019, 55.812921960452286], [37.60366580662049, 55.81206462276091]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263599", "revision": 1, "name": "__Парковочная зона_№56", "geometry": {"type": "Polygon", "coordinates": [[[37.66649946807569, 55.838455310172186], [37.667397619567026, 55.83809171067517], [37.66828948044777, 55.83868488908231], [37.6673568984798, 55.83902400356781], [37.66649946807569, 55.838455310172186]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263601", "revision": 1, "name": "__Парковочная зона_№34", "geometry": {"type": "Polygon", "coordinates": [[[37.521051162378505, 55.777784345811874], [37.522376446878, 55.77801721559754], [37.52201564731243, 55.77856061237044], [37.52064426565032, 55.778344057070115], [37.521051162378505, 55.777784345811874]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263602", "revision": 1, "name": "__Парковочная зона_№28", "geometry": {"type": "Polygon", "coordinates": [[[37.70905205307927, 55.781605222552955], [37.71047232643718, 55.78136439569681], [37.71100357372374, 55.78215698480141], [37.70929057226925, 55.78239475838894], [37.70905205307927, 55.781605222552955]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263603", "revision": 1, "name": "__Парковочная зона_№47", "geometry": {"type": "Polygon", "coordinates": [[[37.661579213348205, 55.676168006123824], [37.66354400902569, 55.67600971238495], [37.663762068931106, 55.677281536076826], [37.66191388777709, 55.67737532674726], [37.661579213348205, 55.676168006123824]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263604", "revision": 1, "name": "__Парковочная зона_№12", "geometry": {"type": "Polygon", "coordinates": [[[37.642539080673686, 55.729890062004266], [37.64438826320443, 55.72947857179785], [37.64484721694093, 55.73016104099126], [37.642922284764424, 55.730572524004515], [37.642539080673686, 55.729890062004266]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263605", "revision": 1, "name": "__Парковочная зона_№43", "geometry": {"type": "Polygon", "coordinates": [[[37.78300783718563, 55.78756982334106], [37.78517955509309, 55.787661582930916], [37.785223543343015, 55.78832531348004], [37.782920464226365, 55.78825860245199], [37.78300783718563, 55.78756982334106]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263606", "revision": 1, "name": "__Парковочная зона_№21", "geometry": {"type": "Polygon", "coordinates": [[[37.583156306616374, 55.77668735863443], [37.58388335475422, 55.777051592804334], [37.58267364440711, 55.77763917094048], [37.582105447122714, 55.77718617211254], [37.583156306616374, 55.77668735863443]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263607", "revision": 1, "name": "__Парковочная зона_№9", "geometry": {"type": "Polygon", "coordinates": [[[37.65884013128008, 55.75828734451705], [37.66073859471677, 55.758230718409024], [37.66083187094058, 55.75927412397028], [37.65887132641917, 55.75928421424089], [37.65884013128008, 55.75828734451705]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263608", "revision": 1, "name": "__Парковочная зона_№17", "geometry": {"type": "Polygon", "coordinates": [[[37.58239337731261, 55.74817577373965], [37.58387240854255, 55.748128254843245], [37.58394824000905, 55.7490356952655], [37.58240482541136, 55.749055073692794], [37.58239337731261, 55.74817577373965]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263610", "revision": 1, "name": "__Парковочная зона_№37", "geometry": {"type": "Polygon", "coordinates": [[[37.5885114944159, 55.79350251061839], [37.589552947766556, 55.79332583020959], [37.58988265935246, 55.794251927418216], [37.58867951078565, 55.79432710484007], [37.5885114944159, 55.79350251061839]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263612", "revision": 1, "name": "__Парковочная зона_№23", "geometry": {"type": "Polygon", "coordinates": [[[37.60169818936569, 55.77750952512406], [37.602775922817266, 55.777748379091065], [37.602343465100226, 55.778450757202044], [37.60123695598185, 55.77829542620913], [37.60169818936569, 55.77750952512406]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263614", "revision": 1, "name": "__Парковочная зона_№2", "geometry": {"type": "Polygon", "coordinates": [[[37.599519145902306, 55.75154695244949], [37.60135377686833, 55.7514985452925], [37.60125721734388, 55.752799466661656], [37.59942258637773, 55.75282366943691], [37.599519145902306, 55.75154695244949]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263615", "revision": 1, "name": "__Парковочная зона_№4", "geometry": {"type": "Polygon", "coordinates": [[[37.602359219951126, 55.76432969015679], [37.60323898450804, 55.76402270729548], [37.60386393920852, 55.76448393679304], [37.60298685686057, 55.76478184275872], [37.602359219951126, 55.76432969015679]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263616", "revision": 1, "name": "__Парковочная зона_№15", "geometry": {"type": "Polygon", "coordinates": [[[37.579802944731156, 55.747450581515444], [37.58149515610802, 55.747439310010584], [37.58147148348412, 55.7485318580997], [37.579770135213174, 55.74847437012603], [37.579802944731156, 55.747450581515444]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263617", "revision": 1, "name": "__Парковочная зона_№54", "geometry": {"type": "Polygon", "coordinates": [[[37.5475882649966, 55.86521649358139], [37.54918469859498, 55.865395658225076], [37.54868866386986, 55.86644503454203], [37.54717205195143, 55.866294668334206], [37.5475882649966, 55.86521649358139]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263618", "revision": 1, "name": "__Парковочная зона_№39", "geometry": {"type": "Polygon", "coordinates": [[[37.58174190530364, 55.805565206430806], [37.58354094659837, 55.80573105414012], [37.58301305476593, 55.80661234506515], [37.58132269708381, 55.80643777551823], [37.58174190530364, 55.805565206430806]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263619", "revision": 1, "name": "__Парковочная зона_№51", "geometry": {"type": "Polygon", "coordinates": [[[37.41745108864301, 55.73956394295052], [37.41879377782681, 55.74025964996008], [37.417404736219105, 55.740882765098455], [37.41634381893068, 55.740174938288426], [37.41745108864301, 55.73956394295052]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263620", "revision": 1, "name": "__Парковочная зона_№45", "geometry": {"type": "Polygon", "coordinates": [[[37.797902279354695, 55.809805521995294], [37.799642700843826, 55.809820435176846], [37.79968438858303, 55.81071346028647], [37.79791108857308, 55.81065546281478], [37.797902279354695, 55.809805521995294]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263621", "revision": 1, "name": "__Парковочная зона_№27", "geometry": {"type": "Polygon", "coordinates": [[[37.68500491725804, 55.76835654699306], [37.68610285251659, 55.76895455867476], [37.685276133554666, 55.769243811354244], [37.68439258425549, 55.76872712108035], [37.68500491725804, 55.76835654699306]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263622", "revision": 1, "name": "__Парковочная зона_№29", "geometry": {"type": "Polygon", "coordinates": [[[37.715745787762394, 55.78026491024332], [37.71708591430637, 55.780002242158325], [37.71758688597795, 55.78071243623246], [37.71601262505497, 55.78100638015249], [37.715745787762394, 55.78026491024332]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263625", "revision": 1, "name": "__Парковочная зона_№66", "geometry": {"type": "Polygon", "coordinates": [[[37.654788441784895, 55.85519987707891], [37.655735261567145, 55.85534169308129], [37.65534634126, 55.85585464024566], [37.65448803437521, 55.855712826116914], [37.654788441784895, 55.85519987707891]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263626", "revision": 1, "name": "__Парковочная зона_№67", "geometry": {"type": "Polygon", "coordinates": [[[37.36061045501703, 55.84607126441009], [37.362278789024316, 55.84541935383377], [37.363324850540124, 55.8462795113081], [37.36166188095087, 55.846931407397605], [37.36061045501703, 55.84607126441009]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263627", "revision": 1, "name": "__Парковочная зона_№68", "geometry": {"type": "Polygon", "coordinates": [[[37.64023342702845, 55.81970842483201], [37.64118561122875, 55.81943208155078], [37.64174082849481, 55.82000892703745], [37.64078864429454, 55.82026412557274], [37.64023342702845, 55.81970842483201]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263628", "revision": 1, "name": "__Парковочная зона_№69", "geometry": {"type": "Polygon", "coordinates": [[[37.38151351156987, 55.83661637634093], [37.38205799999989, 55.836231475344626], [37.382929717929734, 55.836628451604206], [37.38218138161459, 55.836966557447006], [37.38151351156987, 55.83661637634093]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263629", "revision": 1, "name": "__Парковочная зона_№70", "geometry": {"type": "Polygon", "coordinates": [[[37.53243404760696, 55.60539887101477], [37.53478902712205, 55.604849202912945], [37.53565269842476, 55.60613377429212], [37.53313678636896, 55.60654069825715], [37.53243404760696, 55.60539887101477]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263630", "revision": 1, "name": "__Парковочная зона_№71", "geometry": {"type": "Polygon", "coordinates": [[[37.59936028570548, 55.594154949172264], [37.60148459524525, 55.59386940496811], [37.60181718916312, 55.59485968763884], [37.599810896819974, 55.595005494010394], [37.59936028570548, 55.594154949172264]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263631", "revision": 1, "name": "__Парковочная зона_№72", "geometry": {"type": "Polygon", "coordinates": [[[37.66528818119813, 55.61994092944352], [37.66785237301637, 55.61881163711907], [37.67070624340822, 55.62026878238616], [37.668388814819316, 55.62141624599424], [37.66528818119813, 55.61994092944352]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263632", "revision": 1, "name": "__Парковочная зона_№73", "geometry": {"type": "Polygon", "coordinates": [[[37.783380479705734, 55.75109823785793], [37.78392765034478, 55.75027832401682], [37.785832018745346, 55.75054457100973], [37.785300941360404, 55.75140986109286], [37.783380479705734, 55.75109823785793]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263633", "revision": 1, "name": "__Парковочная зона_№74", "geometry": {"type": "Polygon", "coordinates": [[[37.71780223544303, 55.75265542046589], [37.718220660049376, 55.75207152177298], [37.71995873149102, 55.752316578769964], [37.719465205032286, 55.7529398031792], [37.71780223544303, 55.75265542046589]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263634", "revision": 1, "name": "__Парковочная зона №75", "geometry": {"type": "Polygon", "coordinates": [[[37.790416335967954, 55.71733074080949], [37.79335603704828, 55.71688560610267], [37.793876385597166, 55.71823916317902], [37.791038608459395, 55.71856013400989], [37.790416335967954, 55.71733074080949]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263635", "revision": 1, "name": "__Парковочная зона_№76", "geometry": {"type": "Polygon", "coordinates": [[[37.85324084257499, 55.684148526993766], [37.856330747360154, 55.68335447735719], [37.8578005979003, 55.684954682961774], [37.85491454100027, 55.685597171256006], [37.85324084257499, 55.684148526993766]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263636", "revision": 1, "name": "__Парковочная зона_№77", "geometry": {"type": "Polygon", "coordinates": [[[37.87891799007403, 55.7103033337929], [37.88062923942552, 55.71035482093476], [37.88053804431902, 55.7112512919031], [37.87891262565601, 55.711263406234174], [37.87891799007403, 55.7103033337929]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263637", "revision": 1, "name": "__Парковочная зона_№78", "geometry": {"type": "Polygon", "coordinates": [[[37.92732087829587, 55.70298541018822], [37.92879609325407, 55.70225838898354], [37.930442969589215, 55.70319745548105], [37.92873172023771, 55.70388508012462], [37.92732087829587, 55.70298541018822]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277120", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №324", "geometry": {"type": "Polygon", "coordinates": [[[30.3395524744081, 60.05977316914318], [30.33955248054638, 60.06022282932501], [30.33865151945362, 60.06022282932501], [30.3386515255919, 60.05977316914318], [30.3395524744081, 60.05977316914318]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277121", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №325", "geometry": {"type": "Polygon", "coordinates": [[[30.256559805740967, 60.010704169144695], [30.256559811858015, 60.01115382932654], [30.255660188141988, 60.01115382932654], [30.255660194259036, 60.010704169144695], [30.256559805740967, 60.010704169144695]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277122", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №326", "geometry": {"type": "Polygon", "coordinates": [[[30.260564768471003, 60.007964169144785], [30.260564774586864, 60.00841382932663], [30.25966522541313, 60.00841382932663], [30.25966523152899, 60.007964169144785], [30.260564768471003, 60.007964169144785]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277123", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №327", "geometry": {"type": "Polygon", "coordinates": [[[30.266420751348278, 60.00670516914481], [30.2664207574636, 60.00715482932665], [30.265521242536394, 60.00715482932665], [30.26552124865172, 60.00670516914481], [30.266420751348278, 60.00670516914481]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263623", "revision": 2, "name": "__Парковочная зона_№33", "geometry": {"type": "Polygon", "coordinates": [[[37.56026341239907, 55.76324155230809], [37.56174681547812, 55.7630416550671], [37.56223613372341, 55.76394687127842], [37.560696071630275, 55.764171495564995], [37.56026341239907, 55.76324155230809]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-264538", "revision": 1, "name": "Парковка №79", "geometry": {"type": "Polygon", "coordinates": [[[37.65635500193038, 55.63440711398975], [37.65697306667001, 55.63457541681566], [37.656652177532195, 55.6349161916118], [37.65604067181629, 55.63475759828051], [37.65635500193038, 55.63440711398975]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263561", "revision": 3, "name": "__Парковочная зона_№8", "geometry": {"type": "Polygon", "coordinates": [[[37.552745647457876, 55.66965285300127], [37.55414576056356, 55.669198077195986], [37.55543858530891, 55.67038654676748], [37.554043836620956, 55.6708564673279], [37.552745647457876, 55.66965285300127]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277117", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №321", "geometry": {"type": "Polygon", "coordinates": [[[30.334170373064556, 60.052347169143424], [30.334170379199612, 60.05279682932526], [30.333269620800387, 60.05279682932526], [30.33326962693544, 60.052347169143424], [30.334170373064556, 60.052347169143424]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277118", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №322", "geometry": {"type": "Polygon", "coordinates": [[[30.332923348848784, 60.05057216914345], [30.33292335498307, 60.05102182932531], [30.332022645016938, 60.05102182932531], [30.33202265115122, 60.05057216914345], [30.332923348848784, 60.05057216914345]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277119", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №323", "geometry": {"type": "Polygon", "coordinates": [[[30.334231580530513, 60.067545169142925], [30.334231586672168, 60.06799482932478], [30.33333041332783, 60.06799482932478], [30.33333041946948, 60.067545169142925], [30.334231580530513, 60.067545169142925]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-263624", "revision": 3, "name": "__Парковочная зона_№16", "geometry": {"type": "Polygon", "coordinates": [[[37.59220335556542, 55.73343901156776], [37.593096362780024, 55.73329666435785], [37.593448033762606, 55.73403953314517], [37.5926142969385, 55.734146291569516], [37.59220335556542, 55.73343901156776]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277106", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №310", "geometry": {"type": "Polygon", "coordinates": [[[30.46728456766303, 59.9193991691475], [30.467284573740848, 59.919848829329354], [30.466387426259157, 59.919848829329354], [30.46638743233697, 59.9193991691475], [30.46728456766303, 59.9193991691475]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-281182", "revision": 3, "name": "СПБ_парт-тайм Парковка Яндекс №340", "geometry": {"type": "Polygon", "coordinates": [[[30.417213627603438, 59.92383316914737], [30.41721363368315, 59.924282829329215], [30.41631636631686, 59.924282829329215], [30.416316372396576, 59.92383316914737], [30.417213627603438, 59.92383316914737]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277107", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №311", "geometry": {"type": "Polygon", "coordinates": [[[30.467627577813996, 59.92015016914748], [30.46762758389214, 59.92059982932931], [30.466730416107854, 59.92059982932931], [30.466730422186, 59.92015016914748], [30.467627577813996, 59.92015016914748]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277109", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №313", "geometry": {"type": "Polygon", "coordinates": [[[30.475129948184087, 59.947524169146654], [30.475129954273946, 59.9479738293285], [30.47423204572605, 59.9479738293285], [30.474232051815907, 59.947524169146654], [30.475129948184087, 59.947524169146654]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277110", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №314", "geometry": {"type": "Polygon", "coordinates": [[[30.409238324398135, 59.9752761691458], [30.409238330499917, 59.97572582932764], [30.408339669500084, 59.97572582932764], [30.408339675601862, 59.9752761691458], [30.409238324398135, 59.9752761691458]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277111", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №315", "geometry": {"type": "Polygon", "coordinates": [[[30.399163829426094, 60.01244516914463], [30.39916383554389, 60.012894829326484], [30.3982641644561, 60.012894829326484], [30.3982641705739, 60.01244516914463], [30.399163829426094, 60.01244516914463]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277112", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №316", "geometry": {"type": "Polygon", "coordinates": [[[30.39904083484103, 60.012843169144624], [30.399040840959, 60.01329282932648], [30.398141159040996, 60.01329282932648], [30.398141165158965, 60.012843169144624], [30.39904083484103, 60.012843169144624]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277113", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №317", "geometry": {"type": "Polygon", "coordinates": [[[30.42091914829524, 60.03586316914392], [30.420919154423157, 60.036312829325766], [30.420018845576845, 60.036312829325766], [30.420018851704764, 60.03586316914392], [30.42091914829524, 60.03586316914392]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277114", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №318", "geometry": {"type": "Polygon", "coordinates": [[[30.42113613409573, 60.03482116914394], [30.421136140223194, 60.035270829325796], [30.42023585977681, 60.035270829325796], [30.420235865904274, 60.03482116914394], [30.42113613409573, 60.03482116914394]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277115", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №319", "geometry": {"type": "Polygon", "coordinates": [[[30.320323162468533, 60.03690316914388], [30.320323168596904, 60.03735282932573], [30.319422831403102, 60.03735282932573], [30.31942283753147, 60.03690316914388], [30.320323162468533, 60.03690316914388]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277116", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №320", "geometry": {"type": "Polygon", "coordinates": [[[30.339332360021768, 60.05139116914344], [30.339332366156416, 60.051840829325315], [30.338431633843587, 60.051840829325315], [30.338431639978236, 60.05139116914344], [30.339332360021768, 60.05139116914344]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277097", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №301", "geometry": {"type": "Polygon", "coordinates": [[[30.350113407617748, 59.83331316915013], [30.3501134136589, 59.83376282933198], [30.34921858634111, 59.83376282933198], [30.34921859238226, 59.83331316915013], [30.350113407617748, 59.83331316915013]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277098", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №302", "geometry": {"type": "Polygon", "coordinates": [[[30.32287467668911, 59.85332716914952], [30.322874682738753, 59.853776829331366], [30.32197931726125, 59.853776829331366], [30.32197932331089, 59.85332716914952], [30.32287467668911, 59.85332716914952]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277099", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №303", "geometry": {"type": "Polygon", "coordinates": [[[30.325340676890914, 59.85334216914952], [30.325340682940563, 59.85379182933136], [30.324445317059435, 59.85379182933136], [30.32444532310909, 59.85334216914952], [30.325340676890914, 59.85334216914952]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277100", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №304", "geometry": {"type": "Polygon", "coordinates": [[[30.369996688232654, 59.854185169149495], [30.36999669428267, 59.85463482933133], [30.36910130571734, 59.85463482933133], [30.369101311767352, 59.854185169149495], [30.369996688232654, 59.854185169149495]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277101", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №305", "geometry": {"type": "Polygon", "coordinates": [[[30.26698065112896, 59.851427169149574], [30.266980657177797, 59.851876829331424], [30.2660853428222, 59.851876829331424], [30.26608534887104, 59.851427169149574], [30.26698065112896, 59.851427169149574]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277102", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №306", "geometry": {"type": "Polygon", "coordinates": [[[30.22138066089522, 59.85215316914954], [30.22138066694437, 59.85260282933142], [30.220485333055624, 59.85260282933142], [30.220485339104776, 59.85215316914954], [30.22138066089522, 59.85215316914954]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277103", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №307", "geometry": {"type": "Polygon", "coordinates": [[[30.37971891638046, 59.871132169148986], [30.379718922437686, 59.87158182933082], [30.37882307756231, 59.87158182933082], [30.378823083619533, 59.871132169148986], [30.37971891638046, 59.871132169148986]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277104", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №308", "geometry": {"type": "Polygon", "coordinates": [[[30.485912405063836, 59.90736416914786], [30.485912411136507, 59.9078138293297], [30.485015588863497, 59.9078138293297], [30.48501559493617, 59.90736416914786], [30.485912405063836, 59.90736416914786]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277105", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №309", "geometry": {"type": "Polygon", "coordinates": [[[30.506081476598624, 59.912660169147706], [30.50608148267356, 59.91310982932955], [30.505184517326445, 59.91310982932955], [30.505184523401383, 59.912660169147706], [30.506081476598624, 59.912660169147706]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277124", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №328", "geometry": {"type": "Polygon", "coordinates": [[[30.297608710227312, 60.00368116914491], [30.297608716341323, 60.004130829326755], [30.296709283658675, 60.004130829326755], [30.296709289772686, 60.00368116914491], [30.297608710227312, 60.00368116914491]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277125", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №329", "geometry": {"type": "Polygon", "coordinates": [[[30.299564669604504, 60.000693169145], [30.299564675717228, 60.00114282932685], [30.298665324282776, 60.00114282932685], [30.298665330395504, 60.000693169145], [30.299564669604504, 60.000693169145]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277126", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №330", "geometry": {"type": "Polygon", "coordinates": [[[30.297857732853643, 60.00534516914485], [30.297857738968375, 60.00579482932671], [30.296958261031634, 60.00579482932671], [30.296958267146366, 60.00534516914485], [30.297857732853643, 60.00534516914485]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277127", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №331", "geometry": {"type": "Polygon", "coordinates": [[[30.30724339130293, 59.9063451691479], [30.307243397375164, 59.90679482932977], [30.306346602624842, 59.90679482932977], [30.306346608697076, 59.9063451691479], [30.30724339130293, 59.9063451691479]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277128", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №332", "geometry": {"type": "Polygon", "coordinates": [[[30.318685360084583, 59.90403316914797], [30.31868536615583, 59.904482829329815], [30.317788633844167, 59.904482829329815], [30.31778863991541, 59.90403316914797], [30.318685360084583, 59.90403316914797]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277129", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №333", "geometry": {"type": "Polygon", "coordinates": [[[30.369163090794313, 59.884074169148576], [30.36916309685705, 59.88452382933045], [30.368266903142956, 59.88452382933045], [30.368266909205687, 59.884074169148576], [30.369163090794313, 59.884074169148576]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277130", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №334", "geometry": {"type": "Polygon", "coordinates": [[[30.425624383133755, 60.05308516914339], [30.425624389269124, 60.05353482932523], [30.424723610730872, 60.05353482932523], [30.424723616866242, 60.05308516914339], [30.425624383133755, 60.05308516914339]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277131", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №335", "geometry": {"type": "Polygon", "coordinates": [[[30.429218443751054, 60.05752716914325], [30.429218449888356, 60.057976829325106], [30.42831755011165, 60.057976829325106], [30.428317556248953, 60.05752716914325], [30.429218443751054, 60.05752716914325]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277132", "revision": 1, "name": "СПБ парт-тайм_Парковка Яндекс №336", "geometry": {"type": "Polygon", "coordinates": [[[30.429588448773774, 60.05789516914324], [30.42958845491124, 60.05834482932509], [30.428687545088756, 60.05834482932509], [30.428687551226222, 60.05789516914324], [30.429588448773774, 60.05789516914324]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-281183", "revision": 8, "name": "СПБ парт-тайм_Парковка Яндекс №341", "geometry": {"type": "Polygon", "coordinates": [[[30.30625082095885, 59.90518633888549], [30.306293105498103, 59.905575055324526], [30.305003427051382, 59.905583889736185], [30.30497171364679, 59.905182805078844], [30.30625082095885, 59.90518633888549]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-277108", "revision": 6, "name": "СПБ парт-тайм_Парковка Яндекс №312", "geometry": {"type": "Polygon", "coordinates": [[[30.436548906687726, 59.9330603842606], [30.436450990352057, 59.93358692741844], [30.435485389190454, 59.93340044517554], [30.435445715973156, 59.93301459750396], [30.436548906687726, 59.9330603842606]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-281179", "revision": 3, "name": "СПБ парт-тайм__Парковка Яндекс №340", "geometry": {"type": "Polygon", "coordinates": [[[30.439749581477134, 59.92042116914746], [30.439749587555383, 59.92087082932931], [30.438852412444618, 59.92087082932931], [30.438852418522867, 59.92042116914746], [30.439749581477134, 59.92042116914746]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-281180", "revision": 3, "name": "СПБ парт-тайм_Парковка Яндекс №338", "geometry": {"type": "Polygon", "coordinates": [[[30.315311703315647, 59.855306169149465], [30.31531170936613, 59.855755829331315], [30.31441629063387, 59.855755829331315], [30.314416296684353, 59.855306169149465], [30.315311703315647, 59.855306169149465]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-281181", "revision": 3, "name": "СПБ парт-тайм_Парковка Яндекс №339", "geometry": {"type": "Polygon", "coordinates": [[[30.334775013177246, 60.002589617175545], [30.334775019290785, 60.003039277357395], [30.333875616291056, 60.003039277357395], [30.333875622404598, 60.002589617175545], [30.334775013177246, 60.002589617175545]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278765", "revision": 1, "name": "Мск_м. Солнцево, Ул. Богданова", "geometry": {"type": "Polygon", "coordinates": [[[37.39052744247255, 55.64821916926366], [37.39052744704774, 55.648668829445505], [37.38973055295227, 55.648668829445505], [37.38973055752746, 55.64821916926366], [37.39052744247255, 55.64821916926366]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278766", "revision": 1, "name": "Мск_м. Рассказовка, ул Гумилевский бульвар ", "geometry": {"type": "Polygon", "coordinates": [[[37.33433329385933, 55.63360616926401], [37.3343332984303, 55.63405582944586], [37.333536701569685, 55.63405582944586], [37.333536706140656, 55.63360616926401], [37.33433329385933, 55.63360616926401]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278767", "revision": 1, "name": "Мск_ м. Бульвар Скобелевского", "geometry": {"type": "Polygon", "coordinates": [[[37.555846425254764, 55.54792716926608], [37.555846429801164, 55.54837682944792], [37.55505157019885, 55.54837682944792], [37.55505157474525, 55.54792716926608], [37.555846425254764, 55.54792716926608]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278769", "revision": 1, "name": "Мск_м.Нагорная", "geometry": {"type": "Polygon", "coordinates": [[[37.61041569064892, 55.672592169263076], [37.61041569523114, 55.673041829444934], [37.60961830476886, 55.673041829444934], [37.60961830935108, 55.672592169263076], [37.61041569064892, 55.672592169263076]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278770", "revision": 1, "name": "Мск_м. Каховка", "geometry": {"type": "Polygon", "coordinates": [[[37.598413486585514, 55.65255416926356], [37.59841349116194, 55.65300382944541], [37.597616508838044, 55.65300382944541], [37.59761651341448, 55.65255416926356], [37.598413486585514, 55.65255416926356]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-278771", "revision": 1, "name": "Мск_м. Севастопольская ", "geometry": {"type": "Polygon", "coordinates": [[[37.598587477283644, 55.65164016926359], [37.598587481859816, 55.652089829445444], [37.59779051814018, 55.652089829445444], [37.59779052271635, 55.65164016926359], [37.598587477283644, 55.65164016926359]]]}, "property_types": ["parking_place"], "enabled": true}, {"id": "polygon-176751", "revision": 1, "name": "Регион Тюмень для Ya.Bike (можно перерисовать)", "geometry": {"type": "Polygon", "coordinates": [[[65.45537016137439, 57.119510530993786], [65.66001002709675, 57.119510530993786], [65.66000480870929, 57.20128800006214], [65.45536494298692, 57.20128800006214], [65.45537016137439, 57.119510530993786]]]}, "property_types": ["region"], "enabled": false}];
    </script>
    
    <script>
        // Основной класс для управления картой
class BikeMap {
    constructor(config) {
        this.config = config;
        this.API_URL = "https://script.google.com/macros/s/AKfycbwsgAJ_wWj1CYpMdN5uiT3hAzTYC3B9KfCwjKvRIqX4yOxgTMH6gL0bqNgMwjbPp1KYzA/exec";
        this.map = null;
        this.bikePlacemarks = [];
        this.warehousePlacemarks = [];
        this.parkingPolygons = [];
        
        // Настройки безопасности
        this.security = {
            failedAttempts: 0,
            lockedUntil: 0,
            maxAttempts: 5,
            lockoutTime: 300000 // 5 минут
        };
        
        this.init();
    }
    
    async init() {
        try {
            await this.loadYandexMap();
            this.renderParkingPolygons();
            this.renderWarehouses();
            await this.loadBikesData();
            this.setupEventListeners();
            this.setupSecurity();
            this.setupAutoRefresh();
            this.updateSidebar();
        } catch (error) {
            console.error('Ошибка инициализации карты:', error);
        }
    }
    
    loadYandexMap() {
        return new Promise((resolve) => {
            ymaps.ready(() => {
                this.map = new ymaps.Map('map', {
                    center: this.config.mapCenter || [55.75, 37.62],
                    zoom: this.config.mapZoom || 10
                });
                resolve();
            });
        });
    }
    
    renderParkingPolygons() {
        // POLYGONS_DATA теперь глобальная переменная
        if (!window.POLYGONS_DATA || !Array.isArray(window.POLYGONS_DATA)) {
            console.log('Нет данных о парковках');
            return;
        }
        
        window.POLYGONS_DATA.forEach((polygonData, index) => {
            const polygonName = polygonData.name || "Парковка";
            const coordinates = polygonData.geometry?.coordinates;
            
            if (!coordinates) return;
            
            // Конвертируем координаты для Яндекс.Карт
            const convertedCoords = coordinates.map(ring => 
                ring.map(coord => [coord[1], coord[0]]) // [lat, lon]
            );
            
            const polygon = new ymaps.Polygon(convertedCoords, {
                hintContent: polygonName,
                balloonContent: `
                    <div class="balloon-content">
                        <div class="balloon-title">${polygonName}</div>
                        <div>Парковка</div>
                    </div>
                `
            }, {
                fillColor: '#FF6B00',
                fillOpacity: 0.3,
                strokeColor: '#FF6B00',
                strokeWidth: 2,
                strokeOpacity: 0.8
            });
            
            this.map.geoObjects.add(polygon);
            this.parkingPolygons.push(polygon);
        });
    }
    
    renderWarehouses() {
        const warehouses = [
            {"name": "ВЦ Вавилова", "coords": [55.679507, 37.545999]},
            {"name": "ВЦ Подъемная", "coords": [55.741768, 37.70723]},
            {"name": "ВЦ Бакунинская", "coords": [55.778414, 37.691617]},
            {"name": "ВЦ Заневский", "coords": [59.93349, 30.433283]},
            {"name": "ВЦ Обводный", "coords": [59.904325, 30.305712]},
            {"name": "ВЦ Крестинского", "coords": [56.791908, 60.610989]},
            {"name": "ВЦ Победы", "coords": [55.188904, 61.359874]},
            {"name": "ВЦ Московский Тракт", "coords": [57.132862, 65.482295]},
            {"name": "ВЦ Автомобильная", "coords": [45.092232, 38.992749]},
            {"name": "ВЦ Олимпийский", "coords": [55.789881, 37.623106]},
            {"name": "РЦ Добролюбова", "coords": [55.806509, 37.596270]}
        ];
        
        warehouses.forEach(warehouse => {
            const placemark = new ymaps.Placemark(warehouse.coords, {
                hintContent: warehouse.name,
                balloonContent: `
                    <div class="balloon-content">
                        <div class="balloon-title">${warehouse.name}</div>
                        <div>Склад</div>
                    </div>
                `
            }, {
                preset: 'islands#yellowHomeIcon'
            });
            
            this.map.geoObjects.add(placemark);
            this.warehousePlacemarks.push({
                placemark: placemark,
                name: warehouse.name,
                type: 'warehouse'
            });
        });
    }
    
    async loadBikesData() {
        console.log('🔄 Загрузка данных из Google Sheets...');
        
        try {
            // 🔥 ИСПОЛЬЗУЙТЕ CORS PROXY
            const proxyUrl = 'https://corsproxy.io/?';
            const targetUrl = `${this.config.sheetsUrl}?action=get_bikes&t=${Date.now()}`;
            
            const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            console.log('✅ Данные из Google Sheets загружены:', data);
            return data;
            
        } catch (error) {
            console.error('❌ Ошибка загрузки данных из Google Sheets:', error);
            console.log('🔄 Используем локальные данные как fallback...');
            
            // Возвращаем локальные данные как fallback
            return window.BIKES_DATA || [];
        }
    }
    
    renderBikes(bikesData) {
        if (!Array.isArray(bikesData)) {
            console.error('bikesData не является массивом:', bikesData);
            return;
        }
        
        console.log(`Рендеринг ${bikesData.length} байков`);
        bikesData.forEach(bike => {
            this.addBikeMarker(bike);
        });
        this.updateSidebar();
        this.buildStatusChips();
    }
    
    addBikeMarker(bike) {
        // Проверяем обязательные поля
        if (!bike || !bike.label || typeof bike.lat !== 'number' || typeof bike.lon !== 'number') {
            console.error('Некорректные данные байка:', bike);
            return;
        }
        
        // СТАРАЯ ЛОГИКА ОПРЕДЕЛЕНИЯ ИКОНОК
        const preset_map = {
            "islands#blueBicycleCircleIcon": "islands#blueBicycleIcon",
            "islands#redBicycleCircleIcon": "islands#redBicycleIcon", 
            "islands#redCircleIcon": "islands#redIcon",
            "islands#darkorangeBicycle2CircleIcon": "islands#orangeBicycleIcon",
            "islands#darkOrangeCircleIcon": "islands#darkOrangeIcon",
            "islands#blackAttentionCircleIcon": "islands#blackIcon"
        };
        
        let preset, iconContent;
        
        // Если оффлайн >= 2 дней — красный круг и цифра дней
        if (bike.heartbeat_days >= 2) {
            preset = "islands#redIcon";
            iconContent = String(bike.heartbeat_days);
        } else {
            // иначе как раньше
            preset = preset_map[bike.preset] || "islands#blueBicycleIcon";
            iconContent = "";
        }
        
        const routeUrl = `https://yandex.ru/maps/?rtext=~${bike.lat},${bike.lon}&rtt=auto`;
        
        const balloonContent = `
            <div class="balloon-content">
                <div class="balloon-title">Байк ${bike.label}</div>
                ${bike.heartbeat_days > 0 ? `<div class="balloon-days">Оффлайн: ${bike.heartbeat_days} дней</div>` : ''}
                <div class="balloon-actions">
                    <a class="route-link" href="${routeUrl}" target="_blank">Посмотреть маршрут</a>
                    <button class="edit-link" onclick="bikeMap.editBike('${bike.label}')">Редактировать</button>
                    <button class="delete-link" onclick="bikeMap.deleteBike('${bike.label}')">Удалить</button>
                </div>
            </div>
        `;
        
        const placemark = new ymaps.Placemark([bike.lat, bike.lon], {
            hintContent: `Байк ${bike.label}`,
            balloonContent: balloonContent,
            iconCaption: bike.label,
            iconContent: iconContent
        }, {
            preset: preset,
            iconCaptionMaxWidth: 100,
            iconCaptionOffset: [10, 0]
        });
        
        this.map.geoObjects.add(placemark);
        this.bikePlacemarks.push({
            placemark: placemark,
            name: `Байк ${bike.label}`,
            status: bike.status || 'Онлайн',
            plate: bike.label,
            lat: bike.lat,
            lon: bike.lon,
            type: 'bike'
        });
    }
    
    getPresetConfig(status) {
        // Соответствие между preset и текстовым статусом
        const statusMap = {
            "islands#blueBicycleCircleIcon": "Онлайн",
            "islands#redCircleIcon": "Оффлайн >2 дней", 
            "islands#redBicycleCircleIcon": "Оффлайн <2 дней",
            "islands#blackAttentionCircleIcon": "Утерян",
            "islands#darkOrangeCircleIcon": "Утерян (парт-тайм)",
            "islands#darkorangeBicycle2CircleIcon": "Парт-тайм"
        };
        
        // Находим текстовый статус по preset
        let textStatus = "Онлайн";
        for (const [preset, text] of Object.entries(statusMap)) {
            if (status === text) {
                // Если status уже текстовый, используем его
                textStatus = status;
                break;
            }
        }
        
        // Конфигурация иконок по текстовому статусу
        const config = {
            "Онлайн": { icon: "islands#blueBicycleIcon", color: "#1E98FF" },
            "Парт-тайм": { icon: "islands#orangeBicycleIcon", color: "#FF6B00" },
            "Оффлайн <2 дней": { icon: "islands#redBicycleIcon", color: "#FF3333" },
            "Оффлайн >2 дней": { icon: "islands#redIcon", color: "#CC0000" },
            "Утерян": { icon: "islands#blackIcon", color: "#000000" },
            "Утерян (парт-тайм)": { icon: "islands#darkOrangeIcon", color: "#FF8C00" }
        };
        
        return config[textStatus] || config["Онлайн"];
    }
    
    setupEventListeners() {
        // Поиск
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.handleSearch(e.target.value);
            });
        }
        
        // Обновление данных каждые 5 минут
        setInterval(() => {
            this.loadBikesData();
        }, 300000);
    }
    
    handleSearch(searchText) {
        const searchLower = searchText.toLowerCase();
        
        this.bikePlacemarks.forEach(bike => {
            const bikeName = bike.name.toLowerCase();
            const isVisible = bikeName.includes(searchLower);
            bike.placemark.options.set('visible', isVisible);
        });
        
        this.updateSidebar();
    }
    
    buildStatusChips() {
        const statusConfig = {
            "Онлайн": { color: "#1E98FF" },
            "Парт-тайм": { color: "#FF6B00" },
            "Оффлайн <2 дней": { color: "#FF3333" },
            "Оффлайн >2 дней": { color: "#CC0000" },
            "Утерян": { color: "#000000" },
            "Утерян (парт-тайм)": { color: "#FF8C00" }
        };
        
        const container = document.getElementById('statusChips');
        if (!container) return;
        
        container.innerHTML = '';
        
        Object.keys(statusConfig).forEach(status => {
            const chip = document.createElement('div');
            chip.className = 'chip active';
            chip.dataset.status = status;
            chip.style.borderLeftColor = statusConfig[status].color;
            
            chip.innerHTML = `
                <span class="chip-label">${status}</span>
                <span class="chip-count" data-count="0">0</span>
            `;
            
            chip.addEventListener('click', () => {
                chip.classList.toggle('active');
                this.applyFilters();
                this.updateChipCounts();
            });
            
            container.appendChild(chip);
        });
        
        this.updateChipCounts();
    }
    
    applyFilters() {
        const activeStatuses = this.getActiveStatuses();
        
        this.bikePlacemarks.forEach(bike => {
            const isVisible = activeStatuses.includes(bike.status);
            bike.placemark.options.set('visible', isVisible);
        });
        
        this.updateSidebar();
    }
    
    getActiveStatuses() {
        const chips = document.querySelectorAll('#statusChips .chip.active');
        return Array.from(chips).map(chip => chip.dataset.status);
    }
    
    updateChipCounts() {
        const counts = {};
        const statuses = ["Онлайн", "Парт-тайм", "Оффлайн <2 дней", "Оффлайн >2 дней", "Утерян", "Утерян (парт-тайм)"];
        
        statuses.forEach(status => {
            counts[status] = 0;
        });
        
        this.bikePlacemarks.forEach(bike => {
            if (counts[bike.status] !== undefined) {
                counts[bike.status]++;
            }
        });
        
        document.querySelectorAll('#statusChips .chip').forEach(chip => {
            const status = chip.dataset.status;
            const countElement = chip.querySelector('.chip-count');
            if (countElement) {
                countElement.textContent = counts[status] || 0;
            }
        });
    }
    
    updateSidebar() {
        const bikeList = document.getElementById('bikeList');
        const bikeCount = document.getElementById('bikeCount');
        
        if (!bikeList || !bikeCount) return;
        
        const visibleBikes = this.bikePlacemarks.filter(bike => 
            bike.placemark.options.get('visible') !== false
        );
        
        bikeCount.textContent = visibleBikes.length;
        bikeList.innerHTML = '';
        
        visibleBikes.forEach(bike => {
            const li = document.createElement('li');
            li.className = 'object-item bike';
            li.innerHTML = `
                <div class="object-title">${bike.name}</div>
                <div class="object-subtitle">Статус: ${bike.status}</div>
            `;
            
            li.addEventListener('click', () => {
                this.map.setCenter(bike.placemark.geometry.getCoordinates(), 16);
                bike.placemark.balloon.open();
            });
            
            bikeList.appendChild(li);
        });
    }
    
    // Функции управления данными (только в режиме редактирования)
    setupSecurity() {
        this.checkEditSession();
    }
    
    checkEditSession() {
        if (sessionStorage.getItem('editUnlocked') === 'true') {
            this.unlockEditing();
        }
    }
    
    checkEditPassword() {
        const now = Date.now();
        
        if (now < this.security.lockedUntil) {
            const minutesLeft = Math.ceil((this.security.lockedUntil - now) / 60000);
            alert(`Система заблокирована. Попробуйте через ${minutesLeft} минут.`);
            return;
        }
        
        const input = document.getElementById('passwordInput').value;
        
        if (!input) {
            alert('Введите пароль');
            return;
        }
        
        // Хешируем введенный пароль
        const inputHash = CryptoJS.SHA256('yandex_bikes_secure_' + input).toString();
        
        // Имитируем задержку
        setTimeout(() => {
            if (inputHash === this.config.passwordHash) {
                this.security.failedAttempts = 0;
                this.unlockEditing();
            } else {
                this.security.failedAttempts++;
                this.handleFailedAttempt();
            }
        }, 800 + Math.random() * 400);
    }
    
    handleFailedAttempt() {
        const attemptsLeft = this.security.maxAttempts - this.security.failedAttempts;
        
        if (attemptsLeft > 0) {
            alert(`Неверный пароль. Осталось попыток: ${attemptsLeft}`);
        } else {
            this.security.lockedUntil = Date.now() + this.security.lockoutTime;
            const minutes = this.security.lockoutTime / 60000;
            alert(`Слишком много неудачных попыток. Система заблокирована на ${minutes} минут.`);
            
            setTimeout(() => {
                this.security.failedAttempts = 0;
            }, this.security.lockoutTime);
        }
        
        document.getElementById('passwordInput').value = '';
    }
    
    unlockEditing() {
        const loginSection = document.getElementById('loginSection');
        const editSection = document.getElementById('editSection');
        const editProtection = document.getElementById('editProtection');
        
        if (loginSection) loginSection.classList.add('hidden');
        if (editSection) editSection.classList.remove('hidden');
        if (editProtection) {
            editProtection.style.background = '#d4edda';
            editProtection.style.borderColor = '#c3e6cb';
        }
        
        sessionStorage.setItem('editUnlocked', 'true');
    }
    
    lockEditing() {
        const loginSection = document.getElementById('loginSection');
        const editSection = document.getElementById('editSection');
        const editProtection = document.getElementById('editProtection');
        
        if (loginSection) loginSection.classList.remove('hidden');
        if (editSection) editSection.classList.add('hidden');
        if (editProtection) {
            editProtection.style.background = '#fff3cd';
            editProtection.style.borderColor = '#ffeaa7';
        }
        
        document.getElementById('passwordInput').value = '';
        sessionStorage.removeItem('editUnlocked');
    }
    
    async addBike() {
        if (!this.checkEditPermissions()) return;
        
        const plate = document.getElementById('bikeNumber')?.value.trim();
        const lat = parseFloat(document.getElementById('bikeLat')?.value);
        const lon = parseFloat(document.getElementById('bikeLon')?.value);
        const status = document.getElementById('bikeStatus')?.value;
        
        if (!this.validateBikeForm(plate, lat, lon)) return;
        
        const bikeData = {
            'Номер': plate,
            'Широта': lat.toString(),
            'Долгота': lon.toString(),
            'Статус': status || 'Онлайн',
            'Источник': 'manual',
            'Активный': 'TRUE',
            'Дата_создания': new Date().toISOString().split('T')[0],
            'Дата_обновления': new Date().toISOString().split('T')[0],
            'Комментарий': 'Добавлен через интерфейс'
        };
        
        await this.saveBikeToSheets(bikeData, 'add');
    }
    
    editBike(plate) {
        if (!sessionStorage.getItem('editUnlocked')) {
            alert('Режим редактирования заблокирован');
            return;
        }
        
        const bike = this.bikePlacemarks.find(b => b.plate === plate);
        if (!bike) return;
        
        document.getElementById('bikeNumber').value = bike.plate;
        document.getElementById('bikeLat').value = bike.lat;
        document.getElementById('bikeLon').value = bike.lon;
        document.getElementById('bikeStatus').value = bike.status;
        
        alert('Данные байка загружены в форму. После редактирования нажмите "Добавить байк", затем удалите старую запись.');
    }
    
    async deleteBike(plate) {
        if (!this.checkEditPermissions()) return;
        
        if (!confirm(`Удалить байк ${plate}?`)) return;
        
        try {
            const url = `${this.API_URL}?action=delete_bike&plate=${encodeURIComponent(plate)}`;
            const response = await fetch(url);
            const result = await response.json();
            
            if (result.success) {
                this.removeBikeFromMap(plate);
                this.showSuccess('Байк удален!');
            } else {
                this.showError('Ошибка удаления: ' + result.data);
            }
            
        } catch (error) {
            console.error('❌ Ошибка удаления:', error);
            this.showError('Ошибка удаления байка');
        }
    }

    async saveBikeToSheets(bikeData, action) {
        try {
            // Создаем форму для отправки данных
            const formData = new URLSearchParams();
            formData.append('action', 'save_bike');
            Object.keys(bikeData).forEach(key => {
                formData.append(`data[${key}]`, bikeData[key]);
            });
            
            const response = await fetch(this.API_URL, {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.success) {
                if (action === 'add') {
                    this.addBikeMarker(this.convertToMapFormat(bikeData));
                    this.clearBikeForm();
                    this.showSuccess('Байк добавлен!');
                }
            } else {
                this.showError('Ошибка сохранения: ' + result.data);
            }
            
        } catch (error) {
            console.error('❌ Ошибка сохранения:', error);
            this.showError('Ошибка сохранения байка');
        }
    }
    
    // Вспомогательные методы
    checkEditPermissions() {
        if (!sessionStorage.getItem('editUnlocked')) {
            alert('Режим редактирования заблокирован');
            return false;
        }
        return true;
    }
    
    validateBikeForm(plate, lat, lon) {
        if (!plate || isNaN(lat) || isNaN(lon)) {
            alert('Пожалуйста, заполните все поля корректно');
            return false;
        }
        return true;
    }
    
    clearBikeForm() {
        document.getElementById('bikeNumber').value = '';
        document.getElementById('bikeLat').value = '';
        document.getElementById('bikeLon').value = '';
    }
    
    showSuccess(message) {
        alert('✅ ' + message);
    }
    
    showError(message) {
        alert('❌ ' + message);
    }
    
    // Автообновление каждые 2 минуты
    setupAutoRefresh() {
        setInterval(() => {
            this.loadBikesData();
        }, 120000);
    }

    convertToMapFormat(sheetsData) {
        return {
            label: sheetsData['Номер'],
            lat: parseFloat(sheetsData['Широта']),
            lon: parseFloat(sheetsData['Долгота']),
            status: sheetsData['Статус'],
            preset: this._getPresetByStatus(sheetsData['Статус']),
            heartbeat_days: 0,
            plate: sheetsData['Номер']
        };
    }

    _getPresetByStatus(status) {
        const statusToPreset = {
            'Онлайн': 'islands#blueBicycleCircleIcon',
            'Парт-тайм': 'islands#darkorangeBicycle2CircleIcon',
            'Оффлайн <2 дней': 'islands#redBicycleCircleIcon',
            'Оффлайн >2 дней': 'islands#redCircleIcon',
            'Утерян': 'islands#blackAttentionCircleIcon',
            'Утерян (парт-тайм)': 'islands#darkOrangeCircleIcon'
        };
        return statusToPreset[status] || 'islands#blueBicycleCircleIcon';
    }

    removeBikeFromMap(plate) {
        const bikeIndex = this.bikePlacemarks.findIndex(b => b.plate === plate);
        if (bikeIndex !== -1) {
            const bike = this.bikePlacemarks[bikeIndex];
            this.map.geoObjects.remove(bike.placemark);
            this.bikePlacemarks.splice(bikeIndex, 1);
            this.updateSidebar();
            this.updateChipCounts();
        }
    }

}

// Глобальная переменная для доступа к карте
let bikeMap;

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    console.log('Инициализация карты...');
    console.log('CONFIG:', window.CONFIG);
    console.log('BIKES_DATA:', window.BIKES_DATA);
    console.log('POLYGONS_DATA:', window.POLYGONS_DATA);
    
    bikeMap = new BikeMap(window.CONFIG || {});
});

// Глобальные функции для вызова из HTML
function checkEditPassword() {
    if (bikeMap) bikeMap.checkEditPassword();
}

function addBike() {
    if (bikeMap) bikeMap.addBike();
}

function lockEditing() {
    if (bikeMap) bikeMap.lockEditing();
}

function refreshData() {
    if (bikeMap) bikeMap.loadBikesData();
}
    </script>
</body>
</html>
